<!DOCTYPE html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<link type="text/css" href="css/index.css" media="screen" />
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<title>Messengerjs</title>
	</head>
	<body>
		<div id="mes">
		    <h3>In Iframe</h3>
			<input type="text" event-input="{{'Event.send'}}" attr-value="{{postdata}}" bind-form="{{'postdata'}}"><!-- 事件运行顺序和书写顺序有关 -->
			<div><b>your data:</b>{{postdata}}</div>
		</div>
	</body>
	<!-- // <script src="js/messenger.min.js"></script> -->
	<script src="src/messenger.js"></script>
	<script type="text/javascript">
		var b = document.createElement("script");
		b.setAttribute("type", "text/javascript");
		b.setAttribute("src", "http://" + location.hostname + ":9000/build/HTML-ViewParse.debug.js");
		document.getElementsByTagName("head")[0].appendChild(b)
		b.onload = b.onreadystatechange = function(){
			if(!b.readyState||b.readyState==="complete"||b.readyState==="loaded")
			ViewParser.ready(function() {
				var messenger = new Messenger('iframe1');
				ViewParser.app({//create Mes_App
					Id: "mes",
					Var: "Mes_App",
					Data: {
						postdata: "write something",
						Event: {
							send: function(e,vi) {
								console.log("send:",vi.get("postdata"))
								messenger.add(window.parent,"parent")
								messenger.send(vi.get("postdata"));
							}
						}
					}
				})
				messenger.listen(function(msg) {
					console.log("get:",msg)
					Mes_App.set("postdata", msg);
				});
			})
		}
	</script> 
</html>