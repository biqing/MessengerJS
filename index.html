<!DOCTYPE html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<link type="text/css" href="css/index.css" media="screen" />
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<title>Messengerjs</title>
	<script type="text/javascript">
		(function (ie){if(!ie)return;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src","http://"+location.hostname+"/firebug-lite/build/firebug-lite.js");document.getElementsByTagName("head")[0].appendChild(b)}(!+"\v1")); 
	</script> 
	</head>
	<body>
		<div id="mes">
			<input type="text" attr-value="{{postdata}}" bind-form="{{'postdata'}}">
			<input type="button" value="Send Mes" event-click="{{'Event.post'}}">
			<div><b>your data:</b>{{postdata}}</div>
			<hr>
			<div>
				<h2>In new Window</h2>
				<input type="button" value="create new Window">
			</div>
			<div>
				<h2>In new Iframe</h2>
				<input type="button" value="create new Iframe">
				<iframe id="iframe1" name="mes_iframe" width="100%" height="120" src="iframe1.html" frameborder="0"></iframe>
				<iframe id="iframe2" name="mes_iframe" width="100%" height="120" src="iframe1.html" frameborder="0"></iframe>
			</div>
		</div>
	</body>
	<!-- // <script src="js/messenger.min.js"></script> -->
	<script src="src/messenger.js"></script>
	<script type="text/javascript">
		var b = document.createElement("script");
		b.setAttribute("type", "text/javascript");
		b.setAttribute("src", "http://" + location.hostname + ":9000/build/HTML-ViewParse.debug.js");
		document.getElementsByTagName("head")[0].appendChild(b)
		b.onload = b.onreadystatechange = function(){
			if(!b.readyState||b.readyState==="complete"||b.readyState==="loaded")
			ViewParser.ready(function(){
				messenger = new Messenger('parent');

				ViewParser.app({//create Mes_App
					Id:"mes",
					Var: "Mes_App",
					Data:{
						postdata:"write something",
						Event:{
							post:function (e,vi) {//vi === Mes_App
								console.log("send:",vi.get("postdata"))
								var mes_iframes = document.getElementsByName('mes_iframe');
								for(var i = 0,len = mes_iframes.length;i<len;i+=1){
									console.log(mes_iframes[i].contentWindow)
									messenger.add(mes_iframes[i].contentWindow,"iframe1")
								}
								messenger.send(vi.get("postdata"));
							}
						}
					}
				});
				messenger.listen(function(msg) {
					console.log("get:",msg)
					Mes_App.set("postdata", msg);
				});
			})
		}
	</script> 
	<script defer="defer">
	

	</script>
</html>